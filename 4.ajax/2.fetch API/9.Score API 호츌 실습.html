<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        label {
            display: block;
        }

        .input {
            margin-bottom: 30px;
        }
    </style>
</head>

<body>

    <div class="input">
        <label># 이름: <input type="text" name="name"></label>
        <label># 국어: <input type="text" name="kor"></label>
        <label># 영어: <input type="text" name="math"></label>
        <label># 수학: <input type="text" name="eng"></label>
    </div>

    <button id="get">목록 조회</button>
    <button id="post">등록</button>
    <button id="delete">삭제</button>

    <hr>

    <ul class="content"></ul>

    <script>

        function clearResultDOM() {
            const $content = document.querySelector(".content");
            for (let $li of [...$content.children]) {
                $content.removeChild($li);
            }
        }

        function makeResultDOM(scoreList) {
            const $content = document.querySelector(".content");
            const $fragment = document.createDocumentFragment();

            for (let score of scoreList) {
                const {
                    stuNum,
                    name,
                    kor,
                    math,
                    eng,
                    total,
                    average
                } = score;
                const $li = document.createElement('li');
                $li.textContent =
                    `학번: ${stuNum}, 이름: ${name}, 국어: ${kor}, 영어: ${eng}, 수학: ${math}, 총점: ${total}, 평균: ${average}`;
                $fragment.appendChild($li);
            }
            $content.appendChild($fragment);
        }

        //get버튼 이벤트
        document.getElementById('get').addEventListener('click', e => {
            clearResultDOM();
            fetch('http://localhost/api/score/')
                .then(res => res.json())
                .then(scores => {
                    makeResultDOM(scores);
                });
        });
        //post버튼 이벤트
        document.getElementById('post').addEventListener('click', e => {
            const reqInfo = {
                method: 'POST',
                headers: {
                    'content-type': 'application/json'
                },
                body: JSON.stringify({
                    name: document.querySelector('input[name=name]').value,
                    kor: +document.querySelector('input[name=kor]').value,
                    eng: +document.querySelector('input[name=eng]').value,
                    math: +document.querySelector('input[name=math]').value
                })
            };
            fetch('http://localhost/api/score/', reqInfo)
                .then(res => res.text())
                .then(result => {
                    if (result === 'regSuccess') {
                        alert('등록 성공!')
                    } else {
                        alert('등록 실패!')
                    }
                });
        });
        //delete버튼 이벤트
        document.getElementById('delete').addEventListener('click', e => {
            
        });
    </script>

</body>

</html>